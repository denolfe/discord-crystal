variables:
  crystal_image: crystallang/crystal:0.29.0

stages:
  - build-and-test
  - package

cache:
  paths:
    - lib

build-and-test:
  stage: build-and-test
  image: crystallang/crystal:0.29.0
  script:
    - apt-get update -qq && apt-get install -y -qq libxml2-dev
    - shards install
    - shards build -v

package:
  stage: package
  image: jrei/crystal-alpine
  script: 
    - shards install
    - shards build --production --release --static
  artifacts:
    paths:
      - bin/bot
    expire_in: 1 week
  
